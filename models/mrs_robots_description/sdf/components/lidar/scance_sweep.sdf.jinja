<?xml version="1.0"? encoding="utf-8">

{# scanse_sweep_macro {--> #}
{%- macro scanse_sweep_macro(parent_link, x, y, z, roll, pitch, yaw, mount, spawner_args) -%}

  {%- set spawner_keyword = 'enable-scanse-sweep' -%}
  {%- set spawner_description = 'Add the Scanse Sweep laser scanner' -%}
  {%- set spawner_default_args = {'horizontal_samples': 500, 'update_rate': 10.0, 'min_range': 0.45, 'max_range': 10.0, 'noise': 0.01} -%}

  {%- if spawner_keyword in spawner_args.keys() -%}
    {{ generic.handle_spawner_args(spawner_keyword, spawner_default_args, spawner_args) }}

    <!-- scanse sweep {-->
    <link name="sweeper_link">
      <pose>{{ x }} {{ y }} {{ z }} {{ roll }} {{ pitch }} {{ yaw }}</pose>
      {{ generic.zero_inertial_macro() }}

      <!-- visuals {-->
      <visual name="base_visual">
        <pose>0 0 -0.031 0 0 0</pose>
        <geometry>
          <cylinder>
            <length>0.0255</length>
            <radius>0.0234</radius>
          </cylinder>
        </geometry>
        <material>
          <script>
            <name>Gazebo/DarkGrey</name>
            <uri>file://media/materials/scripts/gazebo.material</uri>
          </script>
        </material>
      </visual>
      <visual name="rotator_visual">
        <geometry>
          <cylinder>
            <length>0.0385</length>
            <radius>0.0325</radius>
          </cylinder>
        </geometry>
        <material>
          <script>
            <name>Gazebo/DarkGrey</name>
            <uri>file://media/materials/scripts/gazebo.material</uri>
          </script>
        </material>
      </visual>
      <!--}-->

      <!-- sensor {-->
      <sensor name='sweeper_sensor' type='ray'>
        <visualize>false</visualize>
        <update_rate>{{ spawner_args[spawner_keyword]['update_rate'] }}</update_rate>
        <ray>
          <scan>
            <horizontal>
              <samples>{{ spawner_args[spawner_keyword]['horizontal_samples'] | int }}</samples>
              <resolution>1</resolution>
              <min_angle>0</min_angle>
              <max_angle>6.283185</max_angle>
            </horizontal>
          </scan>
          <range>
            <min>{{ spawner_args[spawner_keyword]['min_range'] }}</min>
            <max>{{ spawner_args[spawner_keyword]['max_range'] }}</max>
            <resolution>0.01</resolution>
          </range>
          <noise>
            <type>gaussian</type>
            <mean>0.0</mean>
            <stddev>{{ spawner_args[spawner_keyword]['noise'] }}</stddev>
          </noise>
        </ray>
        <plugin name='sweeper_plugin' filename='libMrsGazeboCommonResources_2DLidarPlugin.so'>
          <topicName>scanse_sweep/range</topicName>
          <frameName>{{ spawner_args['name'] }}/scanse_sweep</frameName>
          <parentFrameName>{{ spawner_args['name'] }}/fcu</parentFrameName>
          <x>{{ x }}</x>
          <y>{{ y }}</y>
          <z>{{ z }}</z>
          <roll>{{ roll }}</roll>
          <pitch>{{ pitch }}</pitch>
          <yaw>{{ yaw }}</yaw>
        </plugin>
      </sensor>
      <!--}-->

    </link>

    <joint name="sweeper_joint" type="fixed">
      <parent>{{ parent_link }}</parent>
      <child>sweeper_link</child>
    </joint>

    <!-- mount {-->
    {{ mount if mount }}
    <!--}-->

    <!--}-->

  {%- endif -%}
{%- endmacro -%}
{# <!--}--> #}